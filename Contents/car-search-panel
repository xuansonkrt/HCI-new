"use strict";function SortByContent(n,t){return $(t).html()<$(n).html()?1:-1}function switchSearchModeCar(n,t){carSearchPanel.initialiseAdvancedSearchValidation(t);t?($(carConstant._basicSearchMode).hide(),$(carConstant._advancedSearchMode).show(),$(carConstant._advancedSearchId).hide(),$(carConstant._basicSearchId).show()):($(carConstant._advancedSearchMode).hide(),$(carConstant._basicSearchMode).show(),$(carConstant._basicSearchId).hide(),$(carConstant._advancedSearchId).show())}var carConstant={_searchPanelFormId:"#carForm",_briefSearchPanelFormId:"#carBriefSearchForm",_searchResultsFormId:"#carSearchResults",_searchResultsTableId:"#carSearchResultsTable",_passengerDetailsFormId:"#carPassengerDetailsForm",_basicSearchId:"#aBasicCar",_advancedSearchId:"#aAdvanceCar",_allPlaceCarUrlId:"#hdnAllPlaceCar",_fromPlaceBasicId:"#ddlFromPlaceBasicCar",_currencyListId:"#currency-list",_pickUpDateId:"#ddPickUpDateCar",_returnDateId:"#ddReturnDateCar",_pickUpTimeId:"#ddlPickUpTimeCar",_returnTimeId:"#ddlReturnTimeCar",_nationalityId:"#ddlNationalityCar",_hdnSelectedCurrencyId:"#hiddenSelectedCurrencyCar",_advancedFromPlaceDropDownId:"#fromPlaceDropdown_Car",_advancedFromSubPlaceDropDownId:"#fromSubPlaceDropdown_Car",_advancedSelectedFromPlaceId:"#selectedFromPlace_Car",_advancedSelectedFromSubPlaceId:"#selectedFromSubPlace_Car",_subsubPlaceAddressUrl:"#hdnSubSubPlace",_tbPickUpAddressCar:"#tbPickUpAddressCar",_tbReturnAddressCar:"#tbReturnAddressCar",_ddlPickupAddress:"#ddlPickUpAddress",_ddlDropoffAddress:"#ddlDropOffAddress",_hiddenFromSubPlaceId:"#hiddenFromSubPlaceIdCar",_hiddenFromSubPlaceNameId:"#hiddenFromSubPlaceNameCar",_hiddenFromCountryNameId:"#hiddenFromCountryNameCar",_basicFromPlaceStringId:"#ddlFromPlaceBasicCar",_hdnPickUpTimeId:"#hiddenPickUpTimeCar",_hdnReturnTimeId:"#hiddenReturnTimeCar",_hdnSelectedCarId:"#hdnSelectedCarId",_paymentInfoId:"#payment-info",_paymentOptionsId:"#payment-option",_hiddenUniqueSubPlaceName:"#hiddenUniqueSubPlaceNameCar",_redeemButtonId:"#btnRedeemEasiPoint",_discountButtonId:"#btnDiscountCode",_fileUploadButtonId:"#txtUploadFile",_fixedPickUpDateId:"#fixedPickUpDateTime",_fixedReturnDateId:"#fixedReturnDateTime",_fixedFromSubPlaceId:"#fixedFromSubPlace",_loadingSpinnerClass:".loading-spinner",_basicSearchMode:"#car-search-box .basic-mode",_advancedSearchMode:"#car-search-box .advance-mode",_advancedFromPlaceDropDown:"#fromPlaceDropdown_Car .place",_advancedFromSubPlaceDropDown:"#fromSubPlaceDropdown_Car .place",_searchResultsPreloader:"#carSearchResults .preloader",_paymentInfoPreloader:"#payment-info .preloader",_paymentInfoPanelBody:"#payment-info .panel-body",_paymentOptionsPreloader:"#payment-option .preloader",_paymentOptionsPanelBody:"#payment-option .panel-body",_hiddenFromSubPlaceIdValue:"hiddenFromSubPlaceIdCar",_placeIdAttribute:"data-placeid",_subPlaceIdAttribute:"data-subplaceid",_placeNameAttribute:"data-placename",_subPlaceNameAttribute:"data-subplacename",_countryNameAttribute:"data-countryname",_uniqueSubPlaceNameAttribute:"data-uniquesubplacename",_click:"click",_change:"change",_value:"value",_span:"span",_class:"class",_disabled:"disabled",_changeDate:"changeDate",_setDate:"setDate",_setStartDate:"setStartDate",_preloader:"preloader",_hide:"hide",_loading:"loading",_carPlaceListLocalStorageName:"carPlaceList",_singapore:"1",_malaysia:"2",_empty:"",_nineOClock:"09:00",_twelveOClock:"12:00",_selectLocation:"Select Location",_selectSubLocation:"Select Sub-Location",_dailyRateColumnTitle:"Daily Rate",_companyColumnTitle:"Company",_companyStarRatingPrefix:"star-rating star-",_currentCountry:"my"},carGeneral={_placesListCar:[],initialiseTypeAhead:function(n,t,i){var u,r;$(carConstant._fromPlaceBasicId).siblings(carConstant._loadingSpinnerClass).show();u=JSON.parse(sessionStorage.getItem(carConstant._carPlaceListLocalStorageName));this._currentCountry=$("#CountryCode").val();u===null?(r=this,$.getJSON($(carConstant._allPlaceCarUrlId).val(),null,function(n){var t=r._placesListCar=[];$.each(n,function(n,i){var r={PlaceId:i.PlaceId,PlaceName:i.PlaceName,SubPlaceId:i.SubPlaceId,SubPlaceName:i.SubPlaceName,CountryId:i.CountryId,CountryName:i.CountryName,SubPlaceAcronym:i.SubPlaceAcronym,UniqueSubPlaceName:i.UniqueSubPlaceName,CountryCode:i.CountryCode};t.push(r)});sessionStorage.setItem(carConstant._carPlaceListLocalStorageName,JSON.stringify(t))}).done(function(){r.initialiseTypeAheadCallBack(r,t,n,i)})):(r=this,this._placesListCar=r.sortReplaceTopCurrentCountry(u),this.initialiseTypeAheadCallBack(this,t,n,i))},initialiseTypeAheadCallBack:function(n,t,i,r){n.initialiseTextBox(t);$(carConstant._fromPlaceBasicId).parent().siblings(carConstant._loadingSpinnerClass).hide();i!==null&&i(n._placesListCar,r)},initialiseTextBox:function(n){var i=this,t=new Bloodhound({initialize:!1,datumTokenizer:function(n){var i=Bloodhound.tokenizers.whitespace(n.SubPlaceName+" "+n.PlaceName+" "+n.CountryName+" "+n.SubPlaceAcronym),t;return $.each(i,function(n,r){for(t=0;t+1<r.length;)i.push(r.substr(t,r.length)),t++}),i},queryTokenizer:Bloodhound.tokenizers.whitespace,local:i._placesListCar});t.initialize(!0);$(carConstant._fromPlaceBasicId).typeahead({minLength:0,hint:!1,highlight:!0},{display:function(n){var t=n.SubPlaceName;return $.each(i._placesListCar,function(i,r){return r.SubPlaceId===n.SubPlaceId?(t+=", "+r.PlaceName+", "+r.CountryName,!1):!0}),t},limit:999,source:function(n,i){n===""?i(t.all()):t.search(n,i)},templates:{suggestion:function(n){return'<div><i class="fa fa-map-pin"><\/i><div class="tt-suggestion-optionval with-icon">'+n.SubPlaceName+", "+n.PlaceName+", "+n.CountryName+"<\/div><\/div>"}}}).on("typeahead:selected",function(t,i){n(i)}).on(carConstant._click,function(){$(this).select()})},initialiseDatePicker:function(){var n=this;this.setDefaultPickUpDate();this.setSelectablePickUpdate();this.setDefaultReturnDate();this.setSelectableReturnDate();$(carConstant._pickUpDateId).datepicker().on(carConstant._changeDate,function(){this.setSuggestedReturnDate();this.setSelectableReturnDate()}.bind(n))},setDefaultPickUpDate:function(){var n=$(carConstant._pickUpDateId).val(),t=new Date(n);$(carConstant._pickUpDateId).datepicker(carConstant._setDate,t)},setSelectablePickUpdate:function(){var n=new Date;n.setDate(n.getDate()+1);$(carConstant._pickUpDateId).datepicker(carConstant._setStartDate,n)},setDefaultReturnDate:function(){var n=$(carConstant._returnDateId).val(),t=new Date(n);$(carConstant._returnDateId).datepicker(carConstant._setDate,t)},setSelectableReturnDate:function(){var n=new Date($(carConstant._pickUpDateId).val());n.setDate(n.getDate());$(carConstant._returnDateId).datepicker(carConstant._setStartDate,n)},setSuggestedReturnDate:function(){var t=$(carConstant._pickUpDateId).val(),n=new Date(t);n.setDate(n.getDate());$(carConstant._returnDateId).datepicker(carConstant._setDate,n)},setSuggestedReturnTime:function(){$(carConstant._pickUpTimeId).on(carConstant._change,function(){$(carConstant._returnTimeId).val(this.value)})},initialiseCurrencyToggleEvent:function(){$(carConstant._currencyListId).on(carConstant._click,"a",function(n){n.preventDefault();var t=$(this).parent().data(carConstant._value),i=$(carConstant._hdnSelectedCurrencyId).val();t!==i&&$(carConstant._hdnSelectedCurrencyId).val(t).trigger(carConstant._change)})},initialiseInvalidFormControlPriority:function(n){$(n).bind("invalid-form.validate",function(n,t){var i=t.numberOfInvalids();i&&t.errorList[0].element.focus()})},sortCurrentCountry:function(n,t){var i=n.CountryCode.toLowerCase(),r=t.CountryCode.toLowerCase();return i==carGeneral._currentCountry&&r!=carGeneral._currentCountry?1:i!=carGeneral._currentCountry&&r==carGeneral._currentCountry?-1:0},sortReplaceTopCurrentCountry:function(n){if(n&&n[0].CountryCode.toLowerCase()!=carGeneral._currentCountry.toLowerCase()){var t=n.filter(function(n){return n.CountryCode.toLowerCase()==carGeneral._currentCountry.toLowerCase()}),i=n.filter(function(n){return n.CountryCode.toLowerCase()!=carGeneral._currentCountry.toLowerCase()});return t.concat(i)}return n}},carSearchPanel;$(document).ready(function(){carSearchPanel.initialise()});carSearchPanel={_carValidator:null,_locationFromCar:[],resetHiddenFields:function(){$(carConstant._hiddenFromSubPlaceId).val(0)},initialise:function(){carGeneral.initialiseCurrencyToggleEvent();this.initialiseValidator();this.resetHiddenFields();this.initialiseBasicSearch();carGeneral.initialiseDatePicker();this.initialiseTimePicker();carGeneral.initialiseTypeAhead(this.initialiseAdvancedSearch,this.setHiddenFieldForTypeAheadSearch,this);carGeneral.initialiseInvalidFormControlPriority(carConstant._searchPanelFormId)},initialiseValidator:function(){this._carValidator=$(carConstant._searchPanelFormId).validate();this._carValidator.settings.highlight=function(n,t,i){var f=n.id===carConstant._hiddenFromSubPlaceIdValue,r,u;f?(r=$(carConstant._advancedSelectedFromPlaceId),u=$(carConstant._advancedSelectedFromSubPlaceId),r.text()===carConstant._selectLocation?r.parent().addClass(t).removeClass(i):r.parent().removeClass(t).addClass(i),u.text()===carConstant._selectSubLocation&&u.parent().addClass(t).removeClass(i)):$(n).addClass(t).removeClass(i)};this._carValidator.settings.unhighlight=function(n,t,i){$(n).removeClass(t).addClass(i)}},initialiseBasicSearch:function(){$(carConstant._advancedSearchMode).hide();$(carConstant._basicSearchMode).show();$(carConstant._basicSearchId).hide();$(carConstant._advancedSearchId).show()},initialiseTimePicker:function(){$(carConstant._pickUpTimeId).val(carConstant._nineOClock);$(carConstant._returnTimeId).val(carConstant._twelveOClock);carGeneral.setSuggestedReturnTime()},initialiseAdvancedSearch:function(n,t){t._locationFromCar=n;var i=t.getUniqueCountries(),r=t.getUniquePlaces();$.each(i,function(n,t){$(carConstant._advancedFromPlaceDropDownId).append('<div class="flyout-header clearfix">'+t+"<\/div>");var i=$('<ol class="flyout-group clearfix"/>');$.each(r,function(n,r){r.CountryName===t&&(i.attr("data-countryid",r.CountryId),i.append('<li class="place flyout-item" data-countryid="'+r.CountryId+'" data-countryname="'+r.CountryName+'" data-placeid="'+r.PlaceId+'" data-placename="'+r.PlaceName+'" title="'+r.PlaceName+'">'+r.PlaceName+"<\/li>"))});$(carConstant._advancedFromPlaceDropDownId).append(i);i.children().sort(SortByContent).appendTo(i)});$(document).on(carConstant._click,carConstant._advancedFromPlaceDropDown,function(n){$(carConstant._hiddenFromSubPlaceId).val(carConstant._empty);$(carConstant._advancedSelectedFromSubPlaceId).html(carConstant._selectSubLocation);var t=$(n.currentTarget).attr(carConstant._placeIdAttribute),i=$(n.currentTarget).attr(carConstant._placeNameAttribute),r=$(n.currentTarget).attr(carConstant._countryNameAttribute);$(carConstant._advancedSelectedFromPlaceId).html(i+", "+r);this.initialisePickUpSubPlaceSearch(t)}.bind(t))},initialiseAdvancedSearchValidation:function(n){this._carValidator.settings.ignore=n?":hidden:not(#hiddenFromSubPlaceIdCar)":":hidden"},getUniqueCountries:function(){var n=[];return $.each(this._locationFromCar,function(t,i){(n.length===0||$.inArray(i.CountryName,n)<0)&&n.push(i.CountryName)}),n},getUniquePlaces:function(){var t=this,n=[];return $.each(this._locationFromCar,function(i,r){var u={CountryId:r.CountryId,CountryName:r.CountryName,PlaceId:r.PlaceId,PlaceName:r.PlaceName};(n.length===0||t.isNewPlace(n,u))&&n.push(u)}),n},isNewPlace:function(n,t){for(var i=0;i<n.length;i++)if(n[i].PlaceId===t.PlaceId)return!1;return!0},initialisePickUpSubPlaceSearch:function(n){var i=this.getSubPlacesBasedOnPlaceId(n),t=$('<ol class="flyout-group clearfix"/>');$.each(i,function(n,i){t.append('<li class="place flyout-item" data-countryid="'+i.CountryId+'" data-countryname="'+i.CountryName+'" data-placeid="'+i.PlaceId+'" data-placename="'+i.PlaceName+'" data-subplaceid="'+i.SubPlaceId+'" data-subplacename="'+i.SubPlaceName+'" data-uniquesubplacename="'+i.UniqueSubPlaceName+'" title="'+i.SubPlaceName+'">'+i.SubPlaceName+"<\/li>")});$(carConstant._advancedSelectedFromSubPlaceId).parent().removeClass(carConstant._disabled);$(carConstant._advancedFromSubPlaceDropDownId).empty();$(carConstant._advancedFromSubPlaceDropDownId).append(t);t.children().sort(SortByContent).appendTo(t);$(document).on(carConstant._click,carConstant._advancedFromSubPlaceDropDown,function(n){var i=$(n.currentTarget).attr(carConstant._countryNameAttribute),r=$(n.currentTarget).attr(carConstant._placeNameAttribute),u=$(n.currentTarget).attr(carConstant._subPlaceIdAttribute),t=$(n.currentTarget).attr(carConstant._subPlaceNameAttribute),f=$(n.currentTarget).attr(carConstant._uniqueSubPlaceNameAttribute);$(carConstant._advancedSelectedFromSubPlaceId).html(t);$(carConstant._hiddenFromSubPlaceId).val(u);$(carConstant._hiddenFromSubPlaceNameId).val(t);$(carConstant._hiddenFromCountryNameId).val(i);$(carConstant._hiddenUniqueSubPlaceName).val(f);$(carConstant._basicFromPlaceStringId).val(t+", "+r+", "+i)})},getSubPlacesBasedOnPlaceId:function(n){var t=[];return $.each(this._locationFromCar,function(i,r){r.PlaceId===parseInt(n)&&t.push(r)}),t},sortByContent:function(){return $(b).html()<$(a).html()?1:-1},setHiddenFieldForTypeAheadSearch:function(n){$(carConstant._hiddenFromSubPlaceId).val(n.SubPlaceId);$(carConstant._hiddenFromSubPlaceNameId).val(n.SubPlaceName);$(carConstant._hiddenFromCountryNameId).val(n.CountryName);$(carConstant._hiddenUniqueSubPlaceName).val(n.UniqueSubPlaceName);$(carConstant._advancedSelectedFromSubPlaceId).html(n.SubPlaceName);$(carConstant._advancedSelectedFromPlaceId).html(n.PlaceName+", "+n.CountryName)}}