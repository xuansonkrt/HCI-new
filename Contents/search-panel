function SearchProduct(n,t){function i(n,t){$(n).empty();$(n).append($("<option />").val("").text(t))}function r(n){return $.grep(n,function(t,i){return i===$.inArray(t,n)})}this._$search=n;this._type=t;this._country=null;this._fromPlace;this._fromSubPlace;this._toPlace;this._toSubPlace;this._roundTrip;this._departTime;this._returnTime;this._pax=0;this._company;this._locationFrom=[];this._locationTo=[];this._placesList=[];this._subplacesList=[];this._mapping=[];this._searchMode="AdvanceSearchMode";this._isAdvanceMode=!0;this.Initialize=function(){var n,t;this.GetAllVisibleRoutes();this._$search.find("#ddlCountry"+this._type).on("change",$.proxy(function(n){this._$search.find("input[id*='txtFromPlaceBasic']").val("");this._$search.find("input[id*='txtFromPlaceBasic']").next("pre").text("");this._$search.find("input[id*='txtToPlaceBasic']").val("");this._$search.find("input[id*='txtToPlaceBasic']").next("pre").text("");this._$search.find("input[id*='hiddenFromPlace']").val(0);this._$search.find("input[id*='hiddenFromSubPlace']").val(0);this._$search.find("input[id*='hiddenToPlace']").val(0);this._$search.find("input[id*='hiddenToSubPlace']").val(0);this._country=$(n.target).val();this.GetPickUpPoints();this.GetPickUpSubPoints();this.GetDropOffPoints();this.GetDropOffSubPoints()},this));this._$search.find("#ddlFromPlace"+this._type).on("change",$.proxy(function(){this.GetPickUpSubPoints();this.GetDropOffPoints();this.GetDropOffSubPoints()},this));this._$search.find("#ddlFromSubPlace"+this._type).on("change",$.proxy(function(){this.GetDropOffPoints();this.GetDropOffSubPoints()},this));this._$search.find("#ddlToPlace"+this._type).on("change",$.proxy(function(){this.GetDropOffSubPoints()},this));this._$search.find("#TripType"+this._type).on("click",$.proxy(function(n){$(n.target).val()=="1"?(this._$search.find("[id*='dpDepartureDate']").datepicker("setEndDate",null),this._$search.find("[id*='dpReturnDate']").val(""),this._$search.find("[id*='dvReturnDate']").hide()):(this._$search.find("[id*='dpReturnDate']").datepicker("setStartDate",this._$search.find("[id*='dpDepartureDate']").val()?this._$search.find("[id*='dpDepartureDate']").val():"+0d"),this._$search.find("[id*='dvReturnDate']").show())},this));this.EnableBloodHound(!0);this.EnableBloodHound(!1);n=readCookie(this._searchMode);n?this._isAdvanceMode=n==="true":createCookie(this._searchMode,this._isAdvanceMode,60);this._isAdvanceMode==!0?(this._$search.find("a[id*='aBasic']").show(),this._$search.find("div[class*='advance-mode']").show(),this._$search.find("a[id*='aAdvance']").hide(),this._$search.find("div[class*='basic-mode']").hide()):(this._$search.find("a[id*='aAdvance']").show(),this._$search.find("div[class*='basic-mode']").show(),this._$search.find("a[id*='aBasic']").hide(),this._$search.find("div[class*='advance-mode']").hide());this._$search.find("input[id*='hiddenSearchMode']").val(this._isAdvanceMode);t=this;setupDepartReturnDatePicker(this._$search.find("[id*='dpDepartureDate']"),this._$search.find("[id*='dpReturnDate']"))};this._$search.find("#aBasic"+this._type).on("click",$.proxy(function(n){this.SwitchSearchMode(n.target,!1)},this));this._$search.find("#aAdvance"+this._type).on("click",$.proxy(function(n){this.SwitchSearchMode(n.target,!0)},this));this.GetPickUpPoints=function(){if(!this._$search.find("select[id*='ddlCountry']").val()){i(this._$search.find("select[id*='ddlFromPlace']"),"Origin");return}this._country=this._$search.find("select[id*='ddlCountry']").val();var n=this;$.getJSON(this._$search.find("input[id*='hdApiPickUp']").val()+"?country="+this._country,null,function(t){i(n._$search.find("select[id*='ddlFromPlace']"),"Origin");$.each(t,function(t,i){n._$search.find("select[id*='ddlFromPlace']").append($("<option />").val(i.Id).text(i.LocalName))})})};this.GetPickUpSubPoints=function(){if(!this._$search.find("select[id*='ddlFromPlace']").val()){i(this._$search.find("select[id*='ddlFromSubPlace']"),"Any Origin Sub Location");return}this._country=this._$search.find("select[id*='ddlCountry']").val();this._fromPlace=this._$search.find("select[id*='ddlFromPlace']").val();var n=this;$.getJSON(this._$search.find("input[id*='hdApiPickUpSubPlace']").val()+"?country="+this._country+"&placeId="+this._fromPlace,null,function(t){i(n._$search.find("select[id*='ddlFromSubPlace']"),"Any Origin Sub Location");$.each(t,function(t,i){n._$search.find("select[id*='ddlFromSubPlace']").append($("<option />").val(i.Id).text(i.SubPlaceLocalName))})})};this.GetDropOffPoints=function(){if(!this._$search.find("select[id*='ddlFromPlace']").val()){i(this._$search.find("select[id*='ddlToPlace']"),"Destination");return}this._country=this._$search.find("select[id*='ddlCountry']").val();this._fromPlace=this._$search.find("select[id*='ddlFromPlace']").val();this._fromSubPlace=this._$search.find("select[id*='ddlFromSubPlace']").val();var n=this;$.getJSON(this._$search.find("input[id*='hdApiDropOff']").val()+"?country="+this._country+"&fromplaceId="+this._fromPlace+"&fromSubPlaceId="+this._fromSubPlace,null,function(t){i(n._$search.find("select[id*='ddlToPlace']"),"Destination");$.each(t,function(t,i){n._$search.find("select[id*='ddlToPlace']").append($("<option />").val(i.Id).text(i.LocalName))})})};this.GetDropOffSubPoints=function(){if(!this._$search.find("select[id*='ddlFromPlace']").val()||!this._$search.find("select[id*='ddlToPlace']").val()){i(this._$search.find("select[id*='ddlToSubPlace']"),"Any Destination Sub Location");return}this._country=this._$search.find("select[id*='ddlCountry']").val();this._fromPlace=this._$search.find("select[id*='ddlFromPlace']").val();this._fromSubPlace=this._$search.find("select[id*='ddlFromSubPlace']").val();this._toPlace=this._$search.find("select[id*='ddlToPlace']").val();var n=this;$.getJSON(this._$search.find("input[id*='hdApiDropOffSubPlace']").val()+"?country="+this._country+"&fromplaceId="+this._fromPlace+"&fromSubPlaceId="+this._fromSubPlace+"&toPlaceId="+this._toPlace,null,function(t){i(n._$search.find("select[id*='ddlToSubPlace']"),"Any Destination Sub Location");$.each(t,function(t,i){n._$search.find("select[id*='ddlToSubPlace']").append($("<option />").val(i.Id).text(i.SubPlaceLocalName))})})};this.GetAllPlaces=function(){var n=this;$.getJSON(this._$search.find("input[id*='hdApiBasic']").val()+"?country="+this._country,null,function(t){n._placesList=[];$.each(t,function(){var t={};t.id=this.Id;t.name=this.LName;t.subId=0;n._placesList.push(t)});var i=n._mapping.map(function(n){return n.FP});i=r(i);n._placesList.sort(function(n,t){return n.name>t.name?1:-1});$.each(n._placesList,function(){i.indexOf(this.id)>=0&&n._locationFrom.push(this)});n.fromLocationBloodhound.local=n._locationFrom;n.fromLocationBloodhound.initialize(!0)})};this.GetAllSubPlaces=function(){this._subplacesList=[];var n=this;$.getJSON(this._$search.find("input[id*='hdApiBasicSubPlace']").val()+"?country="+this._country,null,function(t){$.each(t,function(){var t={};t.id=this.PlaceId;t.name=this.LName;t.subId=this.Id;n._subplacesList.push(t)});var i=n._mapping.map(function(n){return n.FSP});i=r(i);n._subplacesList.sort(function(n,t){return n.name>t.name?1:-1});$.each(n._subplacesList,function(){i.indexOf(this.subId)>=0&&n._locationFrom.push(this)});n.fromLocationBloodhound.local=n._locationFrom;n.fromLocationBloodhound.initialize(!0)})};this.GetAllVisibleRoutes=function(){this._mapping=[];$.getJSON(this._$search.find("input[id*='hdApiVisible']").val()+"?country="+this._country,null,$.proxy(function(n){this._mapping=n;this._locationFrom=[];this._locationTo=[];this._placesList=[];this._subplacesList=[];this.GetAllPlaces();this.GetAllSubPlaces()},this))};this.fromLocationBloodhound=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:this._locationFrom,sorter:$.proxy(function(n,t){var i=this._$search.find("input[id*='txtFromPlaceBasic']").val();return i==n.name?-1:i==t.name?1:i.toLowerCase()==n.name.toLowerCase()?-1:i.toLowerCase()==t.name.toLowerCase()?1:i!=n.name&&i!=t.name?n.name<t.name?-1:n.name>t.name?1:0:void 0},this)});this.toLocationBloodhound=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:this._locationTo,sorter:$.proxy(function(n,t){var i=this._$search.find("input[id*='txtToPlaceBasic']").val();return i==n.name?-1:i==t.name?1:i.toLowerCase()==n.name.toLowerCase()?-1:i.toLowerCase()==t.name.toLowerCase()?1:i!=n.name&&i!=t.name?n.name<t.name?-1:n.name>t.name?1:0:void 0},this)});this.EnableBloodHound=function(n){var i=n?this._$search.find("input[id*='txtFromPlaceBasic']"):this._$search.find("input[id*='txtToPlaceBasic']"),t=this;$(i).typeahead({hint:!1,highlight:!0,minLength:0},{display:function(n){var i=n.name;return n.subId!=0&&$.each(t._placesList,function(t,r){if(r.id==n.id){i+=", "+r.name;return}}),i},limit:999,source:n?t.BloodhoundSearchWithDefaultsFromPlace:t.BloodhoundSearchWithDefaultsToPlace}).on("typeahead:selected",function(i,r){t.TypeAHeadSelected(r,n)}).on("typeahead:autocompleted",function(i,r){t.TypeAHeadSelected(r,n)}).on("keypress",function(){t._$search.find("div.tt-menu").animate({scrollTop:0},1)})};this.BloodhoundSearchWithDefaultsFromPlace=$.proxy(function(n,t){n===""?t(this.fromLocationBloodhound.index.all()):this.fromLocationBloodhound.search(n,t)},this);this.BloodhoundSearchWithDefaultsToPlace=$.proxy(function(n,t){n===""?t(this.toLocationBloodhound.index.all()):this.toLocationBloodhound.search(n,t)},this);this.TypeAHeadSelected=function(n,t){var i=n.id,r=n.subId;t?(this.FilterLocationAfterSelect(i,r),this._$search.find("[id*='hiddenFromPlace']").val(i),this._$search.find("[id*='hiddenFromSubPlace']").val(r),this._$search.find("input[id*='txtToPlaceBasic']").typeahead("val","")):(this._$search.find("[id*='hiddenToPlace']").val(i),this._$search.find("[id*='hiddenToSubPlace']").val(r));console.log(JSON.stringify(n))};this.FilterLocationAfterSelect=function(n,t){var i=this;i._locationTo=[];result=i._mapping.filter(function(i){return t==0?i.FP==n:i.FP==n&&i.FSP==t}).map(function(n){return n.TP});result=r(result);$.each(i._placesList,function(){result.indexOf(this.id)>=0&&i._locationTo.push(this)});result=i._mapping.filter(function(i){return t==0?i.FP==n:i.FP==n&&i.FSP==t}).map(function(n){return n.TSP});result=r(result);$.each(i._subplacesList,function(){result.indexOf(this.subId)>=0&&i._locationTo.push(this)});i.toLocationBloodhound.local=i._locationTo;i.toLocationBloodhound.initialize(!0)};this.SwitchSearchMode=function(n,t){t?(this._$search.find("a[id*='aBasic']").show(),this._$search.find("div[class*='advance-mode']").show(),this._$search.find("a[id*='aAdvance']").hide(),this._$search.find("div[class*='basic-mode']").hide()):(this._$search.find("a[id*='aAdvance']").show(),this._$search.find("div[class*='basic-mode']").show(),this._$search.find("a[id*='aBasic']").hide(),this._$search.find("div[class*='advance-mode']").hide());createCookie(this._searchMode,t,60);this._$search.find("input[id*='hiddenSearchMode']").val(t)};this.EnableTypeAHead=function(n){var t=n?this._locationFrom:this._locationTo,i=n?this._$search.find("input[id*='txtFromPlaceBasic']"):this._$search.find("input[id*='txtToPlaceBasic']");$(i).typeahead({hint:!1,highlight:!0,minLength:1},{name:"name",limit:10,display:"name",source:u(t),templates:{notFound:['<div class="tt-suggestion"><strong class="tt-highlight" style="color:red;">No result found.<\/strong><\/div>']}}).on("typeahead:selected",function(i,r){var u=0,f=0;r.indexOf(", ")>=0&&(r=r.substring(0,r.lastIndexOf(", ")));$.each(t,function(n,t){r==t.name&&(u=t.id,f=t.subId)});n?(this.FilterLocationAfterSelect(u,f),this._$search.find("input[id*='txtToPlaceBasic']").val(""),this._$search.find("input[id*='txtToPlaceBasic']").next("pre").text(""),this._$search.find("[id*='hiddenFromPlace']").val(u),this._$search.find("[id*='hiddenFromSubPlace']").val(f)):(this._$search.find("[id*='hiddenToPlace']").val(u),this._$search.find("[id*='hiddenToSubPlace']").val(f));console.log(r+" "+u+" "+f)})};var u=function(n){return function(t,i){var u,f=this,r;u=[];substrRegex=new RegExp(t,"i");r="";$.each(n,function(n,t){substrRegex.test(t.name)&&(r=t.name,t.subId!=0&&$.each(f._placesList,function(n,i){if(i.id==t.id){r+=", "+i.name;return}}),u.push(r))});i(u)}};this._$search.find("[id*='rbtnTripType']").on("click",$.proxy(function(n){$(n.target).val()=="1"?(this._$search.find("[id*='dpReturnDate']").val(""),this._$search.find("[id*='dvReturnDate']").hide()):this._$search.find("[id*='dvReturnDate']").show()},this))}function InitProductSearchPanel(n,t){function f(){$("#txtSearchOrigin_"+t).typeahead({hint:!1,highlight:!0,minLength:0,autoselect:!0},{name:"fromPlace",limit:999,displayKey:function(n){return n==null?"Place not found!":n.spid==0?n.pn:n.spn+", "+n.pn},source:r.ttAdapter(),templates:{suggestion:function(n){return n.spid==0?'<div data-placename="'+n.pn.toLowerCase()+'" class="tt-place"><i class="icon-map-pin"><\/i><div class="tt-suggestion-optionval with-icon"><span class="place-name">'+n.pn+',<\/span><span class="country-name"> '+n.ctn+"<\/span>"+(n.ip==!0?'<span class="badge tt-popular">'+JsCommonLabel.SearchIntellisense_Suggestion_Label_Popular+"<\/span>":"")+"<\/div><\/div>":'<div data-placename="'+n.spn.toLowerCase()+", "+n.pn.toLowerCase()+'" class="tt-subplace"><i class="fa fa-map-marker"><\/i><div class="tt-suggestion-optionval with-icon"><span class="place-name">'+n.spn+", "+n.pn+',<\/span><span class="country-name"> '+n.ctn+"<\/span>"+(n.ip==!0?'<span class="badge tt-popular">'+JsCommonLabel.SearchIntellisense_Suggestion_Label_Popular+"<\/span>":"")+"<\/div><\/div>"}}}).bind("typeahead:select",function(n,r){var f="";f=r.spid==0?r.pn:r.spn+", "+r.pn;$("#hdnOrigin_"+t).val(f);$("#hdnDestination_"+t).val("");$("#txtSearchDestination_"+t).typeahead("val","");$("#hdnTC_"+t).val("0");$("#hdnTP_"+t).val("0");$("#hdnTSP_"+t).val("0");$("#hdnFC_"+t).val(r.ctid);$("#hdnFP_"+t).val(r.pid);$("#hdnFSP_"+t).val(r.spid);$("#hdnFPU_"+t).val(r.pusn);$("#hdnFSPU_"+t).val(r.spusn);$("#originBasicMode_"+t).attr("data-countryid",r.ctid);$("#originBasicMode_"+t).attr("data-placeid",r.pid);$("#originBasicMode_"+t).attr("data-subplaceid",r.spid);$("#destinationBasicMode_"+t).attr("data-countryid",0);$("#destinationBasicMode_"+t).attr("data-placeid",0);$("#destinationBasicMode_"+t).attr("data-subplaceid",0);$("#txtSearchOrigin_"+t).removeClass("is-error");$("#txtSearchOrigin_"+t).attr("title",$("#hdnOrigin_"+t).val());$("#txtSearchDestination_"+t).typeahead("destroy");i.clear();i.initialize();u();$("#txtSearchDestination_"+t).focus()}).on("keypress",function(n){n.which==13&&($(this).siblings(".tt-menu").find(".tt-suggestion").length&&$(this).siblings(".tt-menu").find(".tt-suggestion:first-child").trigger("click"),n.preventDefault())}).on("blur",function(n){var t=$(this).val().toLowerCase();$(this).siblings(".tt-menu").find('.tt-suggestion[data-placename="'+t+'"]').length?$(this).siblings(".tt-menu").find(".tt-suggestion:first-child[data-placename]").data("placename")===t&&$(this).siblings(".tt-menu").find(".tt-suggestion:first-child").trigger("click"):$(this).siblings(".tt-menu").find(".tt-suggestion:first-child").trigger("click");n.preventDefault()}).on("click",function(){$(this).select()})}function u(){$("#txtSearchDestination_"+t).typeahead({hint:!1,highlight:!0,minLength:0,autoselect:!0},{name:"toPlace",limit:999,displayKey:function(n){return n==null?"Place not found!":n.spid==0?n.pn:n.spn+", "+n.pn},source:i.ttAdapter(),templates:{suggestion:function(n){return n.spid==0?'<div data-placename="'+n.pn.toLowerCase()+'" class="tt-place"><i class="icon-map-pin"><\/i><div class="tt-suggestion-optionval with-icon"><span class="place-name">'+n.pn+',<\/span><span class="country-name"> '+n.ctn+"<\/span>"+(n.ip==!0?'<span class="badge tt-popular">'+JsCommonLabel.SearchIntellisense_Suggestion_Label_Popular+"<\/span>":"")+"<\/div><\/div>":'<div data-placename="'+n.spn.toLowerCase()+", "+n.pn.toLowerCase()+'" class="tt-subplace"><i class="fa fa-map-marker"><\/i><div class="tt-suggestion-optionval with-icon"><span class="place-name">'+n.spn+", "+n.pn+',<\/span><span class="country-name"> '+n.ctn+"<\/span>"+(n.ip==!0?'<span class="badge tt-popular">'+JsCommonLabel.SearchIntellisense_Suggestion_Label_Popular+"<\/span>":"")+"<\/div><\/div>"}}}).on("typeahead:select",function(n,i){var r="";r=i.spid==0?i.pn:i.spn+", "+i.pn;$("#hdnDestination_"+t).val(r);$("#hdnTC_"+t).val(i.ctid);$("#hdnTP_"+t).val(i.pid);$("#hdnTSP_"+t).val(i.spid);$("#hdnTPU_"+t).val(i.pusn);$("#hdnTSPU_"+t).val(i.spusn);$("#destinationBasicMode_"+t).attr("data-countryid",i.ctid);$("#destinationBasicMode_"+t).attr("data-placeid",i.pid);$("#destinationBasicMode_"+t).attr("data-subplaceid",i.spid);$("#txtSearchDestination_"+t).removeClass("is-error");$("#txtSearchDestination_"+t).attr("title",$("#hdnDestination_"+t).val())}).on("keypress",function(n){n.which==13&&($(this).siblings(".tt-menu").find(".tt-suggestion").length&&$(this).siblings(".tt-menu").find(".tt-suggestion:first-child").trigger("click"),n.preventDefault())}).on("blur",function(n){var t=$(this).val().toLowerCase();$(this).siblings(".tt-menu").find('.tt-suggestion[data-placename="'+t+'"]').length?$(this).siblings(".tt-menu").find(".tt-suggestion:first-child[data-placename]").data("placename")===t&&$(this).siblings(".tt-menu").find(".tt-suggestion:first-child").trigger("click"):$(this).siblings(".tt-menu").find(".tt-suggestion:first-child").trigger("click");n.preventDefault()}).on("click",function(){$(this).select()})}_isAdvancedMode=!1;_isRoundTrip=!0;_isAdvancedMode==!0?($("#aBasic_"+t).show(),$("#originAdvancedMode_"+t).show(),$("#destinationAdvancedMode_"+t).show(),$("#aAdvanced_"+t).hide(),$("#originBasicMode_"+t).hide(),$("#destinationBasicMode_"+t).hide(),$("."+t+".swap").addClass("advanced-mode")):($("#aAdvanced_"+t).show(),$("#originBasicMode_"+t).show(),$("#destinationBasicMode_"+t).show(),$("#aBasic_"+t).hide(),$("#originAdvancedMode_"+t).hide(),$("#destinationAdvancedMode_"+t).hide(),$("."+t+".swap").removeClass("advanced-mode"));t=="Bus"&&$("#busdaypass-search-form").hide();t=="Train"&&$("#trainluxury-search-panel-box-div").hide();$("#aBasic_"+t).click(function(){$("#aAdvanced_"+t).show();$("#originBasicMode_"+t).show();$("#destinationBasicMode_"+t).show();$("#aBasic_"+t).hide();$("#originAdvancedMode_"+t).hide();$("#destinationAdvancedMode_"+t).hide();var n=parseInt($("#originBasicMode_"+t).attr("data-countryid")),r=parseInt($("#originBasicMode_"+t).attr("data-placeid")),u=parseInt($("#originBasicMode_"+t).attr("data-subplaceid")),i=parseInt($("#destinationBasicMode_"+t).attr("data-countryid")),f=parseInt($("#destinationBasicMode_"+t).attr("data-placeid")),e=parseInt($("#originBasicMode_"+t).attr("data-subplaceid")),o=$("#txtSearchOrigin_"+t).val(),s=$("#txtSearchDestination_"+t).val();n!=0?$("#hdnOrigin_"+t).val(o):$("#hdnOrigin_"+t).val("");i!=0?$("#hdnDestination_"+t).val(s):$("#hdnDestination_"+t).val("");$("#hdnFC_"+t).val(n);$("#hdnFP_"+t).val(r);$("#hdnFSP_"+t).val(u);$("#hdnTC_"+t).val(i);$("#hdnTP_"+t).val(f);$("#hdnTSP_"+t).val(e);$("."+t+".swap").removeClass("advanced-mode");$("#locationError_"+t).text("");_isAdvancedMode=!1});$("#aAdvanced_"+t).click(function(){AdvancedSearchMode(t)});var r=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/api/place?productId=#PROD&query=#QUERY",filter:function(n){return $("#txtSearchOrigin_"+t).parent().siblings(".loading-spinner").hide(),n},replace:function(i,r){return $("#txtSearchOrigin_"+t).parent().siblings(".loading-spinner").show(),i.replace("#PROD",encodeURIComponent(n)).replace("#QUERY",encodeURIComponent(r))},cache:!1,ajax:{error:function(){$("#txtSearchOrigin_"+t).parent().siblings(".loading-spinner").hide();engine.clear()}}},sorter:function(n,t){var i=$(Selector).val();return i==n.value?-1:i==t.value?1:i.toLowerCase()==n.value.toLowerCase()?-1:i.toLowerCase()==t.value.toLowerCase()?1:i!=n.value&&i!=t.value?n.value<t.value?-1:n.value>t.value?1:0:void 0}}),i=new Bloodhound({datumTokenizer:function(n){return Bloodhound.tokenizers.whitespace(n.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"/api/place?productId=#PROD&query=#QUERY&fromCountryId=#FROM_C&fromPlaceId=#FROM_P&fromSubPlaceId=#FROM_SP",filter:function(n){return $("#txtSearchDestination_"+t).parent().siblings(".loading-spinner").hide(),n},replace:function(i,r){$("#txtSearchDestination_"+t).parent().siblings(".loading-spinner").show();var u=$("#hdnFC_"+t).val(),f=$("#hdnFP_"+t).val(),e=$("#hdnFSP_"+t).val();return i.replace("#PROD",encodeURIComponent(n)).replace("#QUERY",encodeURIComponent(r)).replace("#FROM_C",encodeURIComponent(u)).replace("#FROM_P",encodeURIComponent(f)).replace("#FROM_SP",encodeURIComponent(e))},cache:!1,ajax:{error:function(){$("#txtSearchDestination_"+t).parent().siblings(".loading-spinner").hide();engine.clear()}}},sorter:function(n,t){var i=$(Selector).val();return i==n.value?-1:i==t.value?1:i.toLowerCase()==n.value.toLowerCase()?-1:i.toLowerCase()==t.value.toLowerCase()?1:i!=n.value&&i!=t.value?n.value<t.value?-1:n.value>t.value?1:0:void 0}});r.initialize();i.initialize();f();u();$("#dpDepartureDate_"+t).datepicker().on("changeDate",function(n){var i=new Date(n.date.valueOf());$("input:radio[data-product="+t+"]:checked").val()==="1"?$("#dpReturnDate_"+t).val(""):($("#dpReturnDate_"+t).datepicker("setStartDate",i),i.setDate(i.getDate()+1),$("#dpReturnDate_"+t).datepicker("setDate",i));$("#dpDepartureDate_"+t).removeClass("is-error")}).on("clearDate",function(){$("#dpReturnDate_"+t).datepicker("setStartDate",null)});$("#dpReturnDate_"+t).datepicker().on("changeDate",function(){$("#dpReturnDate_"+t).removeClass("is-error")});$("#dpReturnDate_"+t).datepicker("setStartDate",$("#dpDepartureDate_"+t).val()?$("#dpDepartureDate_"+t).val():"+0d");$("input:radio[data-product="+t+"]").click(function(){$(this).val()==="1"?($("#dpDepartureDate_"+t).datepicker("setEndDate",null),$("#dpReturnDate_"+t).val(""),$("#dvReturnDate_"+t).hide(),$("#busdaypass-search-form").hide(),$("#trainluxury-search-panel-box-div").hide(),$("#"+t+"-search-panel-box-div").show(),$("#"+t+"-location-error-div").show(),$("#"+t+"-search-option-div").show(),_isRoundTrip=!1):$(this).val()==="DayPass"?($("#busdaypass-search-form").show(),$("#"+t+"-search-panel-box-div").hide(),$("#"+t+"-location-error-div").hide(),$("#"+t+"-search-option-div").hide()):$(this).val()==="TrainLuxury"?($("#trainluxury-search-panel-box-div").show(),$("#"+t+"-search-panel-box-div").hide(),$("#"+t+"-location-error-div").hide(),$("#"+t+"-search-option-div").hide(),$("#hdnSubProductType_"+t).val("TrainLuxury"),_isRoundTrip=!1):($("#dpReturnDate_"+t).datepicker("setStartDate",$("#dpDepartureDate_"+t).val()?$("#dpDepartureDate_"+t).val():"+0d"),$("#dvReturnDate_"+t).show(),$("#"+t+"-search-panel-box-div").show(),$("#"+t+"-location-error-div").show(),$("#"+t+"-search-option-div").show(),$("#busdaypass-search-form").hide(),$("#trainluxury-search-panel-box-div").hide(),_isRoundTrip=!0)});$(document).on("click","#fromPlaceDropdown_"+t+" .place",function(){var r=$(this).attr("data-countryid"),u=$(this).attr("data-placeid"),f=$(this).attr("data-countryname"),e=$(this).attr("data-placename"),o=$(this).attr("default-countryname"),s=$(this).attr("default-placename"),h=$(this).attr("data-uniqueplacename"),c=$(this).attr("data-uniquesubplacename"),i;(parseInt($("#hdnFC_"+t).val())!=r||parseInt($("#hdnFP_"+t).val())!=u)&&($("#selectedFromPlace_"+t).html(e+", "+f),$("#selectedFromPlace_"+t).attr("title",e+", "+f),$("#originAdvancedMode_"+t).attr("data-countryid",r),$("#originAdvancedMode_"+t).attr("data-placeid",u),$("#selectedFromPlace_"+t).parent().removeClass("is-error"),$("#hdnOrigin_"+t).val(s+", "+o),$("#hdnFC_"+t).val(r),$("#hdnFP_"+t).val(u),$("#hdnFPU_"+t).val(h),PrepareFromSubPlaceSelector(n,t));t.toLowerCase()=="train"&&(i=new Date,i.setDate(i.getDate()+90),r=="90"?($("#ddlPax_Train").children("option:gt(3)").hide(),$("#ddlPax_Train").val()>4&&$("#ddlPax_Train").prop("selectedIndex",3),$("#dpDepartureDate_Train").datepicker("setEndDate",i),$("#dpReturnDate_Train").datepicker("setEndDate",i)):($("#ddlPax_Train").children("option").show(),$("#dpDepartureDate_Train").datepicker("setEndDate",null),$("#dpReturnDate_Train").datepicker("setEndDate",null)));t.toLowerCase()=="ferry"&&(i=new Date,i.setDate(i.getDate()+90),r=="90"?($("#ddlPax_Ferry").children("option:gt(3)").hide(),$("#ddlPax_Ferry").val()>4&&$("#ddlPax_Ferry").prop("selectedIndex",3),$("#dpDepartureDate_Ferry").datepicker("setEndDate",i),$("#dpReturnDate_Ferry").datepicker("setEndDate",i)):($("#ddlPax_Ferry").children("option").show(),$("#dpDepartureDate_Ferry").datepicker("setEndDate",null),$("#dpReturnDate_Ferry").datepicker("setEndDate",null)))});$(document).on("click","#fromSubPlaceDropdown_"+t+" .place",function(){var n=$(this).attr("data-countryid"),i=$(this).attr("data-placeid"),r=$(this).attr("data-subplaceid"),c=$(this).attr("data-countryname"),l=$(this).attr("data-placename"),u=$(this).attr("data-subplacename"),f=$(this).attr("data-uniqueplacename"),e=$(this).attr("data-uniquesubplacename"),o=$(this).attr("default-subplacename"),s=$(this).attr("default-countryname"),h=$(this).attr("default-placename");(parseInt($("#hdnFC_"+t).val())!=n||parseInt($("#hdnFP_"+t).val())!=i||parseInt($("#hdnFSP_"+t).val())!=r)&&($("#selectedFromSubPlace_"+t).html(u),$("#selectedFromSubPlace_"+t).attr("title",u),$("#originAdvancedMode_"+t).attr("data-countryid",n),$("#originAdvancedMode_"+t).attr("data-placeid",i),$("#originAdvancedMode_"+t).attr("data-subplaceid",r),$("#selectedFromPlace_"+t).parent().removeClass("is-error"),$("#hdnOrigin_"+t).val(o+", "+h+", "+s),$("#hdnFC_"+t).val(n),$("#hdnFP_"+t).val(i),$("#hdnFSP_"+t).val(r),$("#hdnFPU_"+t).val(f),$("#hdnFSPU_"+t).val(e))});$(document).on("click","#toPlaceDropdown_"+t+" .place",function(){var i=$(this).attr("data-countryid"),r=$(this).attr("data-placeid"),u=$(this).attr("data-countryname"),f=$(this).attr("data-placename"),e=$(this).attr("default-countryname"),o=$(this).attr("default-placename"),s=$(this).attr("data-uniqueplacename"),h=$(this).attr("data-uniquesubplacename");(parseInt($("#hdnTC_"+t).val())!=i||parseInt($("#hdnTP_"+t).val())!=r)&&($("#selectedToPlace_"+t).html(f+", "+u),$("#selectedToPlace_"+t).attr("title",f+", "+u),$("#destinationAdvancedMode_"+t).attr("data-countryid",i),$("#destinationAdvancedMode_"+t).attr("data-placeid",r),$("#selectedToPlace_"+t).parent().removeClass("is-error"),$("#hdnDestination_"+t).val(o+", "+e),$("#hdnTC_"+t).val(i),$("#hdnTP_"+t).val(r),$("#hdnTPU_"+t).val(s),PrepareToSubPlaceSelector(n,t))});$(document).on("click","#toSubPlaceDropdown_"+t+" .place",function(){var n=$(this).attr("data-countryid"),i=$(this).attr("data-placeid"),r=$(this).attr("data-subplaceid"),c=$(this).attr("data-countryname"),l=$(this).attr("data-placename"),u=$(this).attr("data-subplacename"),f=$(this).attr("data-uniqueplacename"),e=$(this).attr("data-uniquesubplacename"),o=$(this).attr("default-countryname"),s=$(this).attr("default-placename"),h=$(this).attr("default-subplacename");(parseInt($("#hdnTC_"+t).val())!=n||parseInt($("#hdnTP_"+t).val())!=i||parseInt($("#hdnTSP_"+t).val())!=r)&&($("#selectedToSubPlace_"+t).html(u),$("#selectedToSubPlace_"+t).attr("title",u),$("#destinationAdvancedMode_"+t).attr("data-countryid",n),$("#destinationAdvancedMode_"+t).attr("data-placeid",i),$("#destinationAdvancedMode_"+t).attr("data-subplaceid",r),$("#selectedToPlace_"+t).parent().removeClass("is-error"),$("#hdnDestination_"+t).val(h+", "+s+", "+o),$("#hdnTC_"+t).val(n),$("#hdnTP_"+t).val(i),$("#hdnTSP_"+t).val(r),$("#hdnTPU_"+t).val(f),$("#hdnTSPU_"+t).val(e))});$("#fromPlaceDropdown_"+t).children("ol").each(function(){$(this).children("li").sort(SortByContent).appendTo(this)});$(document).on("typeahead:select","#txtSearchOrigin_Train",function(){var t=$("#hdnFC_Train").val(),n=new Date;n.setDate(n.getDate()+90);t=="90"?($("#ddlPax_Train").children("option:gt(3)").hide(),$("#ddlPax_Train").val()>4&&$("#ddlPax_Train").prop("selectedIndex",3),$("#dpDepartureDate_Train").datepicker("setEndDate",n),$("#dpReturnDate_Train").datepicker("setEndDate",n)):($("#ddlPax_Train").children("option").show(),$("#dpDepartureDate_Train").datepicker("setEndDate",null),$("#dpReturnDate_Train").datepicker("setEndDate",null))});$(document).on("typeahead:select","#txtSearchOrigin_Ferry",function(){var t=$("#hdnFC_Ferry").val(),n=new Date;n.setDate(n.getDate()+90);t=="90"?($("#ddlPax_Ferry").children("option:gt(3)").hide(),$("#ddlPax_Ferry").val()>4&&$("#ddlPax_Ferry").prop("selectedIndex",3),$("#dpDepartureDate_Ferry").datepicker("setEndDate",n),$("#dpReturnDate_Ferry").datepicker("setEndDate",n)):($("#ddlPax_Ferry").children("option").show(),$("#dpDepartureDate_Ferry").datepicker("setEndDate",null),$("#dpReturnDate_Ferry").datepicker("setEndDate",null))});$("#commonSearchForm_"+t+" .swap a").click(function(){var f=!0,c=$("#hdnFC_"+t).val(),l=$("#hdnFP_"+t).val(),a=$("#hdnFSP_"+t).val(),v=$("#hdnFPU_"+t).val(),y=$("#hdnFSPU_"+t).val(),p=$("#hdnTC_"+t).val(),w=$("#hdnTP_"+t).val(),b=$("#hdnTSP_"+t).val(),k=$("#hdnTPU_"+t).val(),d=$("#hdnTSPU_"+t).val(),n=0,i=0,e=0,r=0,u=0,o=0,s,h;if(_isAdvancedMode?(n=$("#originAdvancedMode_"+t).attr("data-countryid"),i=$("#originAdvancedMode_"+t).attr("data-placeid"),e=$("#originAdvancedMode_"+t).attr("data-subplaceid"),r=$("#destinationAdvancedMode_"+t).attr("data-countryid"),u=$("#destinationAdvancedMode_"+t).attr("data-placeid"),o=$("#destinationAdvancedMode_"+t).attr("data-subplaceid"),(n==0||i==0)&&($("#selectedFromPlace_"+t).parent().addClass("is-error"),f=!1),(r==0||u==0)&&($("#selectedToPlace_"+t).parent().addClass("is-error"),f=!1)):(n=$("#originBasicMode_"+t).attr("data-countryid"),i=$("#originBasicMode_"+t).attr("data-placeid"),e=$("#originBasicMode_"+t).attr("data-subplaceid"),r=$("#destinationBasicMode_"+t).attr("data-countryid"),u=$("#destinationBasicMode_"+t).attr("data-placeid"),o=$("#destinationBasicMode_"+t).attr("data-subplaceid"),(n==0||i==0)&&($("#txtSearchOrigin_"+t).addClass("is-error"),f=!1),(r==0||u==0)&&($("#txtSearchDestination_"+t).addClass("is-error"),f=!1)),f){var g=$("#txtSearchOrigin_"+t).val(),nt=$("#txtSearchDestination_"+t).val(),tt=$("#selectedFromPlace_"+t).html(),it=$("#selectedFromSubPlace_"+t).html(),rt=$("#selectedToPlace_"+t).html(),ut=$("#selectedToSubPlace_"+t).html(),ft=$("#hdnOrigin_"+t).val(),et=$("#hdnDestination_"+t).val();_isAdvancedMode?($("#selectedFromPlace_"+t).html(rt),$("#selectedFromSubPlace_"+t).html(ut),$("#selectedToPlace_"+t).html(tt),$("#selectedToSubPlace_"+t).html(it),$("#originAdvancedMode_"+t).attr("data-countryid",r),$("#originAdvancedMode_"+t).attr("data-placeid",u),$("#originAdvancedMode_"+t).attr("data-subplaceid",o),$("#destinationAdvancedMode_"+t).attr("data-countryid",n),$("#destinationAdvancedMode_"+t).attr("data-placeid",i),$("#destinationAdvancedMode_"+t).attr("data-subplaceid",e),s=$("#toSubPlaceDropdown_"+t).children(),h=$("#fromSubPlaceDropdown_"+t).children(),$("#toSubPlaceDropdown_"+t).append(h),$("#fromSubPlaceDropdown_"+t).append(s)):($("#originBasicMode_"+t).attr("data-countryid",r),$("#originBasicMode_"+t).attr("data-placeid",u),$("#originBasicMode_"+t).attr("data-subplaceid",o),$("#destinationBasicMode_"+t).attr("data-countryid",n),$("#destinationBasicMode_"+t).attr("data-placeid",i),$("#destinationBasicMode_"+t).attr("data-subplaceid",e),$("#txtSearchOrigin_"+t).val(nt),$("#txtSearchDestination_"+t).val(g));$("#hdnOrigin_"+t).val(et);$("#hdnDestination_"+t).val(ft);$("#hdnFC_"+t).val(p);$("#hdnFP_"+t).val(w);$("#hdnFSP_"+t).val(b);$("#hdnFPU_"+t).val(k);$("#hdnFSPU_"+t).val(d);$("#hdnTC_"+t).val(c);$("#hdnTP_"+t).val(l);$("#hdnTSP_"+t).val(a);$("#hdnTPU_"+t).val(v);$("#hdnTSPU_"+t).val(y)}else TriggerShakeAnimation($(".search-wrap"))});$("form#commonSearchForm_"+t).submit(function(n){isValid=!0;$("#locationError_"+t).text("");var i=0,r=0,e=0,u=0,f=0,o=0,s="",h="";_isAdvancedMode?(i=$("#originAdvancedMode_"+t).attr("data-countryid"),r=$("#originAdvancedMode_"+t).attr("data-placeid"),u=$("#destinationAdvancedMode_"+t).attr("data-countryid"),f=$("#destinationAdvancedMode_"+t).attr("data-placeid"),(i==0||r==0)&&($("#selectedFromPlace_"+t).parent().addClass("is-error"),isValid=!1),(u==0||f==0)&&($("#selectedToPlace_"+t).parent().addClass("is-error"),isValid=!1)):(i=$("#originBasicMode_"+t).attr("data-countryid"),r=$("#originBasicMode_"+t).attr("data-placeid"),e=$("#originBasicMode_"+t).attr("data-subplaceid"),u=$("#destinationBasicMode_"+t).attr("data-countryid"),f=$("#destinationBasicMode_"+t).attr("data-placeid"),o=$("#destinationBasicMode_"+t).attr("data-subplaceid"),s=$("#txtSearchOrigin_"+t).val(),h=$("#txtSearchDestination_"+t).val(),(i==0||r==0||s==="")&&($("#txtSearchOrigin_"+t).addClass("is-error"),isValid=!1),(u==0||f==0||h==="")&&($("#txtSearchDestination_"+t).addClass("is-error"),isValid=!1),r===f&&i===u&&(e==0||o==0)&&($("#txtSearchOrigin_"+t).addClass("is-error"),$("#txtSearchDestination_"+t).addClass("is-error"),$("#locationError_"+t).text(JsErrorMsg.Msg1),isValid=!1));_isRoundTrip=$("input:radio[data-product="+t+"]:checked").val()==="1"?!1:!0;_isRoundTrip&&$("#dpReturnDate_"+t).val()===""&&($("#dpReturnDate_"+t).addClass("is-error"),isValid=!1);$("#dpDepartureDate_"+t).val()===""&&($("#dpDepartureDate_"+t).addClass("is-error"),isValid=!1);isValid||(TriggerShakeAnimation($(".search-wrap")),n.preventDefault())});$("#modify-search .swap a").click(function(n){var o,s;if(!$("#txtSearchOrigin_"+t).length)return!1;n.stopImmediatePropagation();n.preventDefault();var i=!0,r=$("#hdnFC_"+t).val(),u=$("#hdnFP_"+t).val(),h=$("#hdnFSP_"+t).val(),c=$("#hdnFPU_"+t).val(),l=$("#hdnFSPU_"+t).val(),f=$("#hdnTC_"+t).val(),e=$("#hdnTP_"+t).val(),a=$("#hdnTSP_"+t).val(),v=$("#hdnTPU_"+t).val(),y=$("#hdnTSPU_"+t).val(),p=$("#txtSearchOrigin_"+t).val(),w=$("#txtSearchDestination_"+t).val(),b=$("#txtSearchOrigin_"+t).val(),k=$("#txtSearchDestination_"+t).val();(r==0||u==0||$.trim(b)==="")&&($("#txtSearchOrigin_"+t).addClass("is-error"),i=!1);(f==0||e==0||$.trim(k)==="")&&($("#txtSearchDestination_"+t).addClass("is-error"),i=!1);i?(o=$("#txtSearchOrigin_"+t).val(),s=$("#txtSearchDestination_"+t).val(),$("#txtSearchOrigin_"+t).val(s),$("#txtSearchDestination_"+t).val(o),$("#hdnOrigin_"+t).val(w),$("#hdnFC_"+t).val(f),$("#hdnFP_"+t).val(e),$("#hdnFSP_"+t).val(a),$("#hdnFPU_"+t).val(v),$("#hdnFSPU_"+t).val(y),$("#hdnDestination_"+t).val(p),$("#hdnTC_"+t).val(r),$("#hdnTP_"+t).val(u),$("#hdnTSP_"+t).val(h),$("#hdnTPU_"+t).val(c),$("#hdnTSPU_"+t).val(l)):TriggerShakeAnimation($(".sub-search-wrap"))});$("form#briefSearchForm_"+t).submit(function(n){isValid=!0;$("#locationError_"+t).text("");var i=$("#hdnFC_"+t).val(),r=$("#hdnFP_"+t).val(),e=$("#hdnFSP_"+t).val(),u=$("#hdnTC_"+t).val(),f=$("#hdnTP_"+t).val(),o=$("#hdnTSP_"+t).val(),s=$("#txtSearchOrigin_"+t).val(),h=$("#txtSearchDestination_"+t).val();(i==0||r==0||$.trim(s)==="")&&($("#txtSearchOrigin_"+t).addClass("is-error"),isValid=!1);(u==0||f==0||$.trim(h)==="")&&($("#txtSearchDestination_"+t).addClass("is-error"),isValid=!1);_isRoundTrip=$("input:radio[data-product="+t+"]:checked").val()==="1"?!1:!0;_isRoundTrip&&$("#dpReturnDate_"+t).val()===""&&($("#dpReturnDate_"+t).addClass("is-error"),isValid=!1);$("#dpDepartureDate_"+t).val()===""&&($("#dpDepartureDate_"+t).addClass("is-error"),isValid=!1);r===f&&i===u&&(e==0||o==0)&&($("#txtSearchOrigin_"+t).addClass("is-error"),$("#txtSearchDestination_"+t).addClass("is-error"),$("#locationError_"+t).text(JsErrorMsg.Msg1),isValid=!1);isValid||(TriggerShakeAnimation($(".sub-search-wrap")),n.preventDefault())});$("#hdnSelectedCurrency_"+t).val()===""&&$("a.toggle-currency").html("Currency <span class='caret'><\/span>");$("#currency-list").on("click","a",function(n){n.preventDefault();$(".SelectedCurrency"+t).val($(this).parent().data("value")).trigger("change")})}function InitDayPassSearchPanel(n,t){function i(){$("#txtSearchOrigin_"+t).change(function(){var n=$(this).find(":selected").data("fromcountryid"),i=$(this).find(":selected").data("fromplaceid"),r=$(this).find(":selected").data("uniquefromplacename"),u=$(this).find(":selected").text();$("#hdnOrigin_"+t).val(u);$("#hdnFC_"+t).val(n);$("#hdnFP_"+t).val(i);$("#hdnFPU_"+t).val(r)})}i();$("form#commonSearchForm_"+t).submit(function(){isValid=!0;$("#locationError_"+t).text("");var n=0,i=0;return n=$("#hdnFC_"+t).val(),i=$("#hdnFP_"+t).val(),n==0||i==0?($("#txtSearchOrigin_"+t).addClass("is-error"),isValid=!1):void 0});$("form#briefSearchForm_"+t).submit(function(n){isValid=!0;$("#locationError_"+t).text("");var i=0,r=0;i=$("#hdnFC_"+t).val();r=$("#hdnFP_"+t).val();(i==0||r==0)&&($("#txtSearchOrigin_"+t).addClass("is-error"),isValid=!1);isValid||(TriggerShakeAnimation($(".sub-search-wrap")),n.preventDefault())});$("#hdnSelectedCurrency_"+t).val()===""&&$("a.toggle-currency").html("Currency <span class='caret'><\/span>");$("#currency-list").on("click","a",function(n){n.preventDefault();$(".SelectedCurrency"+t).val($(this).parent().data("value")).trigger("change")})}function AdvancedSearchMode(n){$("#aBasic_"+n).show();$("#originAdvancedMode_"+n).show();$("#destinationAdvancedMode_"+n).show();$("#aAdvanced_"+n).hide();$("#originBasicMode_"+n).hide();$("#destinationBasicMode_"+n).hide();var r=parseInt($("#originAdvancedMode_"+n).attr("data-countryid")),u=parseInt($("#originAdvancedMode_"+n).attr("data-placeid")),t=parseInt($("#originAdvancedMode_"+n).attr("data-subplaceid")),f=parseInt($("#destinationAdvancedMode_"+n).attr("data-countryid")),e=parseInt($("#destinationAdvancedMode_"+n).attr("data-placeid")),i=parseInt($("#destinationAdvancedMode_"+n).attr("data-subplaceid")),o=$("#selectedFromPlace_"+n).html(),h=$("#selectedFromSubPlace_"+n).html(),s=$("#selectedToPlace_"+n).html(),c=$("#selectedToSubPlace_"+n).html();r!=0&&u!=0&&t!=0?$("#hdnOrigin_"+n).val(h+", "+o):t===0?$("#hdnOrigin_"+n).val(o):$("#hdnOrigin_"+n).val("");f!=0&&e!=0&&i!=0?$("#hdnDestination_"+n).val(c+", "+s):i===0?$("#hdnDestination_"+n).val(s):$("#hdnDestination_"+n).val("");$("#hdnFC_"+n).val(r);$("#hdnFP_"+n).val(u);$("#hdnFSP_"+n).val(t);$("#hdnTC_"+n).val(f);$("#hdnTP_"+n).val(e);$("#hdnTSP_"+n).val(i);$("."+n+".swap").addClass("advanced-mode");$("#locationError_"+n).text("");_isAdvancedMode=!0}function PrepareToPlaceSelector(n,t){$("#selectedToPlace_"+t).html(JsCommonMsg.DestinationLocation);$("#hdnTC_"+t).val("0");$("#hdnTP_"+t).val("0");$("#hdnTSP_"+t).val("0");$("#hdnTPU_"+t).val("");$("#hdnTSPU_"+t).val("");$("#selectedToPlace_"+t).parent().addClass("disabled");$("#destinationAdvancedMode_"+t).attr("data-countryid",0);$("#destinationAdvancedMode_"+t).attr("data-placeid",0);$("#destinationAdvancedMode_"+t).attr("data-subplaceid",0);var i={productId:n,fromCountryId:parseInt($("#hdnFC_"+t).val()),fromPlaceId:parseInt($("#hdnFP_"+t).val()),fromSubPlaceId:parseInt($("#hdnFSP_"+t).val())};$.ajax({dataType:"json",url:"/api/place/country_and_place",data:i,beforeSend:function(){$("#selectedToPlace_"+t).parent().siblings(".loading-spinner").show()},complete:function(){$("#selectedToPlace_"+t).parent().siblings(".loading-spinner").hide()},success:function(n){if($("#selectedToPlace_"+t).parent().removeClass("disabled"),$("#toPlaceDropdown_"+t).empty(),n.length==0)return $("#toPlaceDropdown_"+t).append('<div class="flyout-group clearfix">'+JsCommonMsg.Msg1+"<\/div>"),!1;var i=[];$.each(n,function(n,t){i.push(t.ctn)});$.each(unique(i),function(i,r){$("#toPlaceDropdown_"+t).append('<div class="flyout-header clearfix">'+r+"<\/div>");var u=$('<ol class="flyout-group clearfix"/>');$.each(n,function(n,t){t.ctn===r&&(u.attr("data-countryid",t.ctid),u.append('<li class="place flyout-item" data-countryid="'+t.ctid+'" data-countryname="'+t.ctn+'" default-countryname="'+t.dctn+'" data-placeid="'+t.pid+'" data-placename="'+t.pn+'" default-placename="'+t.pn+'" data-uniqueplacename="'+t.pusn+'" data-uniquesubplacename="'+t.spusn+'" title="'+t.pn+'">'+t.pn+"<\/li>"))});$("#toPlaceDropdown_"+t).append(u);u.children().sort(SortByContent).appendTo(u)});$("div[id^='toPlaceDropdown'] .place[data-placeid='422'], div[id^='toPlaceDropdown'] .place[data-placeid='428']").addClass("bold")}})}function unique(n){return $.grep(n,function(t,i){return i===$.inArray(t,n)})}function PrepareFromSubPlaceSelector(n,t){$("#selectedFromSubPlace_"+t).html(JsCommonMsg.AnySubLocation);$("#hdnFSP_"+t).val("0");$("#hdnFSPU_"+t).val("");$("#selectedFromSubPlace_"+t).parent().addClass("disabled");$("#originAdvancedMode_"+t).attr("data-subplaceid",0);var i=parseInt($("#hdnFC_"+t).val()),r=parseInt($("#hdnFP_"+t).val()),u=$("#hdnFPU_"+t).val(),f={productId:n,fromCountryId:i,fromPlaceId:r,toCountryId:0,toPlaceId:0,fromSubPlaceId:0};$.ajax({dataType:"json",url:"/api/place/subplace_only",data:f,beforeSend:function(){$("#selectedFromSubPlace_"+t).parent().siblings(".loading-spinner").show()},complete:function(){$("#selectedFromSubPlace_"+t).parent().siblings(".loading-spinner").hide()},success:function(n){var f=$('<ol class="flyout-group clearfix"/>');n.length>0?($.each(n,function(t,i){f.append('<li class="place flyout-item" data-countryid="'+i.ctid+'" data-countryname="'+i.ctn+'" default-countryname="'+n[0].dctn+'" data-placeid="'+i.pid+'" data-placename="'+i.pn+'" default-placename="'+i.pn+'" data-subplaceid="'+i.spid+'" data-subplacename="'+i.spn+'" default-subplacename="'+i.spn+'" data-uniqueplacename="'+i.pusn+'" data-uniquesubplacename="'+i.spusn+'" title="'+i.spn+'">'+i.spn+"<\/li>")}),$("#selectedFromSubPlace_"+t).parent().removeClass("disabled"),$("#fromSubPlaceDropdown_"+t).empty(),$("#fromSubPlaceDropdown_"+t).append(f),f.children().sort(SortByContent).appendTo(f),f.prepend('<li class="place flyout-item" data-countryid="'+n[0].ctid+'" data-countryname="'+n[0].ctn+'" default-countryname="'+n[0].dctn+'" data-placeid="'+n[0].pid+'" data-placename="'+n[0].pn+'" default-placename="'+n[0].pn+'" data-subplaceid="0" data-subplacename="" default-subplacename="" data-uniqueplacename="'+n[0].pusn+'" data-uniquesubplacename="">'+JsCommonMsg.AnySubLocation+"<\/li>")):f.append('<li class="place flyout-item" data-countryid="'+i+'" data-countryname="" default-countryname="" data-placeid="'+r+'" data-placename="" default-placename="" data-subplaceid="0" data-subplacename="" default-subplacename="" data-uniqueplacename="'+u+'" data-uniquesubplacename="">'+JsCommonMsg.AnySubLocation+"<\/li>")}})}function PrepareToSubPlaceSelector(n,t){var i;$("#selectedToSubPlace_"+t).html(JsCommonMsg.AnySubLocation);$("#hdnTSP_"+t).val("0");$("#hdnTSPU_"+t).val("");$("#selectedToSubPlace_"+t).parent().addClass("disabled");$("#destinationAdvancedMode_"+t).attr("data-subplaceid",0);var r=parseInt($("#hdnTC_"+t).val()),u=parseInt($("#hdnTP_"+t).val()),f=$("#hdnTPU_"+t).val();parseInt($("#hdnTC_"+t).val())!=0&&(i={productId:n,fromCountryId:parseInt($("#hdnFC_"+t).val()),fromPlaceId:parseInt($("#hdnFP_"+t).val()),toCountryId:parseInt($("#hdnTC_"+t).val()),toPlaceId:parseInt($("#hdnTP_"+t).val()),fromSubPlaceId:parseInt($("#hdnFSP_"+t).val())},$.ajax({dataType:"json",url:"/api/place/subplace_only",data:i,beforeSend:function(){$("#selectedToSubPlace_"+t).parent().siblings(".loading-spinner").show()},complete:function(){$("#selectedToSubPlace_"+t).parent().siblings(".loading-spinner").hide()},success:function(n){var i=$('<ol class="flyout-group clearfix"/>');n.length>0?($.each(n,function(n,t){i.append('<li class="place flyout-item" data-countryid="'+t.ctid+'" data-countryname="'+t.ctn+'" default-countryname="'+t.dctn+'" data-placeid="'+t.pid+'" data-placename="'+t.pn+'" default-placename="'+t.pn+'" data-subplaceid="'+t.spid+'" data-subplacename="'+t.spn+'" default-subplacename="'+t.spn+'" data-uniqueplacename="'+t.pusn+'" data-uniquesubplacename="'+t.spusn+'" title="'+t.spn+'">'+t.spn+"<\/li>")}),$("#selectedToSubPlace_"+t).parent().removeClass("disabled"),$("#toSubPlaceDropdown_"+t).empty(),$("#toSubPlaceDropdown_"+t).append(i),i.children().sort(SortByContent).appendTo(i),i.prepend('<li class="place flyout-item" data-countryid="'+n[0].ctid+'" data-countryname="'+n[0].ctn+'" default-countryname="'+n[0].dctn+'" data-placeid="'+n[0].pid+'" data-placename="'+n[0].pn+'" default-placename="'+n[0].pn+'" data-subplaceid="0" data-subplacename="" default-subplacename="" data-uniqueplacename="'+n[0].pusn+'" data-uniquesubplacename="">'+JsCommonMsg.AnySubLocation+"<\/li>")):i.append('<li class="place flyout-item" data-countryid="'+r+'" data-countryname="" default-countryname="" data-placeid="'+u+'" data-placename="" default-placename="" data-subplaceid="0" data-subplacename="" default-subplacename="" data-uniqueplacename="'+f+'" data-uniquesubplacename="">'+JsCommonMsg.AnySubLocation+"<\/li>")}}))}function TriggerShakeAnimation(n){n.addClass("error-shake");setTimeout(function(){n.removeClass("error-shake")},300)}function SortByContent(n,t){return $(t).html()<$(n).html()?1:-1}function SortByCountryIdAttr(n,t){return $(t).data("countryid")<$(n).data("countryid")?1:-1}function ResetLocationError(n,t,i){$('a[href="#bus-search-box"]').unbind().click(function(){$("#locationError_"+n).text("");$("#locationError_"+t).text("");$("#locationError_"+i).text("")});$('a[href="#ferry-search-box"]').unbind().click(function(){$("#locationError_"+n).text("");$("#locationError_"+t).text("");$("#locationError_"+i).text("")});$('a[href="#train-search-box"]').unbind().click(function(){$("#locationError_"+n).text("");$("#locationError_"+t).text("");$("#locationError_"+i).text("")})}$(document).ready(function(){var n="Bus",t="Ferry",i="Train";InitProductSearchPanel(1,n);InitProductSearchPanel(2,t);InitProductSearchPanel(5,i);InitDayPassSearchPanel(9,"BusDayPass");InitDayPassSearchPanel(11,"Flight");InitProductSearchPanel(13,"TrainLuxury");ResetLocationError(n,t,i);$("div[id^='fromPlaceDropdown'] .place[data-placeid='422'], div[id^='fromPlaceDropdown'] .place[data-placeid='428']").addClass("bold");$("#SearchMode").length>0&&$("#SearchMode").val()==="1"&&AdvancedSearchMode(n)})